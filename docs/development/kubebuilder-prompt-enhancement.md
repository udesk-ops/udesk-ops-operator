# Kubebuilder Development Prompt Enhancement

## ä¿®æ”¹æ¦‚è¿°

å·²æˆåŠŸæ›´æ–° `.github/prompts/dev.prompt.md` æ–‡ä»¶ï¼Œæ·»åŠ äº†è¯¦ç»†çš„ Kubebuilder æ¡†æ¶ä½¿ç”¨è¯´æ˜å’Œæœ€ä½³å®è·µã€‚

## æ–°å¢å†…å®¹

### 1. ğŸ”§ Kubebuilder Framework ç« èŠ‚

- **æ ¸å¿ƒç»„ä»¶è¯´æ˜**: controller-runtimeã€ä»£ç ç”Ÿæˆã€Webhookæ¡†æ¶ã€æµ‹è¯•æ¡†æ¶ç­‰
- **é¡¹ç›®ç»“æ„**: è¯¦ç»†çš„Kubebuilderæ ‡å‡†é¡¹ç›®ç›®å½•ç»“æ„
- **ç”Ÿæˆçš„Makefileç›®æ ‡**: å¼€å‘ã€éƒ¨ç½²ã€è°ƒè¯•ç›¸å…³å‘½ä»¤
- **Kubebuilderæ ‡è®°å’Œæ³¨è§£**: CRDã€RBACã€Webhookæ ‡è®°è¯¦è§£

### 2. ğŸ—ï¸ Kubebuilder Development Workflow

- **æ·»åŠ æ–°CRDçš„å®Œæ•´æµç¨‹**: ä»scaffoldingåˆ°æµ‹è¯•çš„è¯¦ç»†æ­¥éª¤
- **Webhookåˆ›å»ºæµç¨‹**: åŒ…æ‹¬defaultingå’Œvalidation webhook
- **é¡¹ç›®ç»´æŠ¤å‘½ä»¤**: ä¾èµ–æ›´æ–°ã€æ¸…ç†ç­‰æ“ä½œ

### 3. ğŸ”„ å¢å¼ºçš„Development Workflow

- **Kubebuilderç‰¹å®šçš„å¼€å‘æµç¨‹**: æ›¿æ¢äº†åŸæœ‰çš„é€šç”¨æµç¨‹
- **è„šæ‰‹æ¶å‘½ä»¤**: `kubebuilder create api`ã€`kubebuilder create webhook` ç­‰
- **ä»£ç ç”Ÿæˆ**: `make manifests generate` çš„è¯¦ç»†è¯´æ˜

### 4. ğŸ¯ Kubebuilderå®ç°æ¨¡å¼

æ·»åŠ äº†å››ä¸ªé‡è¦çš„ä»£ç æ¨¡å¼ï¼š

#### Kubebuilder Controller Setup Pattern
- main.goä¸­çš„managerè®¾ç½®
- æ§åˆ¶å™¨å’Œwebhookæ³¨å†Œ
- é¢†å¯¼é€‰ä¸¾å’Œå¥åº·æ£€æŸ¥é…ç½®

#### Kubebuilder CRD Type Definition Pattern
- å®Œæ•´çš„ç±»å‹å®šä¹‰ç¤ºä¾‹
- KubebuilderéªŒè¯æ ‡è®°çš„ä½¿ç”¨
- æ‰“å°åˆ—å’Œå­èµ„æºé…ç½®

#### Kubebuilder Controller Implementation Pattern
- æ ‡å‡†çš„Reconcileå‡½æ•°å®ç°
- RBACæ ‡è®°çš„æ­£ç¡®ä½¿ç”¨
- Finalizerå¤„ç†æ¨¡å¼

#### Kubebuilder Webhook Implementation Pattern
- Defaultingå’ŒValidation webhookå®ç°
- Webhookæ ‡è®°çš„é…ç½®
- éªŒè¯é€»è¾‘çš„æœ€ä½³å®è·µ

### 5. ğŸ“š Kubebuilder Command Reference

å…¨æ–°çš„å‘½ä»¤å‚è€ƒç« èŠ‚ï¼ŒåŒ…æ‹¬ï¼š

- **é¡¹ç›®åˆå§‹åŒ–**: `kubebuilder init` ç›¸å…³å‘½ä»¤
- **APIå’Œæ§åˆ¶å™¨ç”Ÿæˆ**: `kubebuilder create api` çš„å„ç§ç”¨æ³•
- **Webhookç”Ÿæˆ**: admissionå’Œconversion webhookåˆ›å»º
- **ä»£ç å’Œæ¸…å•ç”Ÿæˆ**: `make manifests generate` è¯¦è§£
- **æµ‹è¯•å’Œå¼€å‘**: æœ¬åœ°è¿è¡Œã€æµ‹è¯•ã€æ„å»ºå‘½ä»¤
- **è¯ä¹¦ç®¡ç†**: Webhookæ‰€éœ€çš„cert-manageré…ç½®
- **è‡ªå®šä¹‰å’Œé…ç½®**: Kustomizeé…ç½®ç®¡ç†
- **è°ƒè¯•å’Œæ•…éšœæ’é™¤**: æ—¥å¿—æŸ¥çœ‹ã€è¯ä¹¦éªŒè¯ç­‰
- **æœ€ä½³å®è·µå‘½ä»¤**: å®Œæ•´çš„éªŒè¯æµç¨‹

## æŠ€æœ¯ç‰¹ç‚¹

### 1. éµå¾ªé¡¹ç›®è§„èŒƒ
- ä¿æŒäº†åŸæœ‰çš„ä»£ç è´¨é‡é—¨ç¦è¦æ±‚
- ç»§ç»­ä½¿ç”¨Ginkgo v2æµ‹è¯•æ¡†æ¶
- ç»´æŒäº†æ–‡æ¡£ç»“æ„æ ‡å‡†

### 2. å®ç”¨æ€§å¯¼å‘
- æä¾›äº†å®Œæ•´çš„å‘½ä»¤ç¤ºä¾‹
- åŒ…å«äº†å®é™…å¯è¿è¡Œçš„ä»£ç æ¨¡å¼
- è¦†ç›–äº†ä»å¼€å‘åˆ°éƒ¨ç½²çš„å®Œæ•´æµç¨‹

### 3. æœ€ä½³å®è·µé›†æˆ
- èåˆäº†Kubebuilderå®˜æ–¹æ¨èçš„åšæ³•
- ç»“åˆäº†Kubernetes Operatorå¼€å‘çš„è¡Œä¸šæ ‡å‡†
- è€ƒè™‘äº†ç”Ÿäº§ç¯å¢ƒçš„éœ€æ±‚

## éªŒè¯ç»“æœ

âœ… **æµ‹è¯•é€šè¿‡**: ä¿®æ”¹åè¿è¡Œ `make test`ï¼Œæ‰€æœ‰15ä¸ªæµ‹è¯•å¥—ä»¶é€šè¿‡
âœ… **ä»£ç è´¨é‡**: ä¿æŒäº†é¡¹ç›®çš„è´¨é‡æ ‡å‡†
âœ… **å‘åå…¼å®¹**: æ²¡æœ‰ç ´åç°æœ‰çš„å¼€å‘æµç¨‹

## ä½¿ç”¨å»ºè®®

1. **å¼€å‘è€…å‚è€ƒ**: å¼€å‘è€…å¯ä»¥å‚è€ƒæ–°å¢çš„Kubebuilderæ¨¡å¼è¿›è¡Œå¼€å‘
2. **å‘½ä»¤æŸ¥è¯¢**: ä½¿ç”¨å‘½ä»¤å‚è€ƒç« èŠ‚å¿«é€ŸæŸ¥æ‰¾éœ€è¦çš„Kubebuilderå‘½ä»¤
3. **æœ€ä½³å®è·µ**: éµå¾ªæ–°å¢çš„å®ç°æ¨¡å¼ç¡®ä¿ä»£ç è´¨é‡
4. **é¡¹ç›®ç»“æ„**: ç†è§£Kubebuilderé¡¹ç›®ç»“æ„ï¼Œæ›´å¥½åœ°ç»„ç»‡ä»£ç 

è¿™æ¬¡æ›´æ–°ä½¿å¼€å‘promptæ›´åŠ å®Œæ•´å’Œå®ç”¨ï¼Œä¸ºä½¿ç”¨Kubebuilderè¿›è¡ŒKubernetes Operatorå¼€å‘æä¾›äº†å…¨é¢çš„æŒ‡å¯¼ã€‚
